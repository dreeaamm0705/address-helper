<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Address Generator</title>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        padding: 32px;
        background: #f7f9fc;
        color: #111;
      }
      .container {
        max-width: 720px;
        margin: 0 auto;
        background: white;
        padding: 24px;
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(20, 30, 60, 0.08);
      }
      h1 {
        margin: 0 0 12px 0;
        font-size: 20px;
      }
      .row {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
      }
      label {
        font-size: 13px;
        color: #333;
        display: block;
        margin-bottom: 6px;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #d7dbe6;
        border-radius: 6px;
        font-size: 14px;
      }
      .col {
        margin: 12px;
        flex: 1;
      }
      .actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      button {
        background: #2563eb;
        color: white;
        border: 0;
        padding: 10px 14px;
        border-radius: 6px;
        cursor: pointer;
      }
      button.secondary {
        background: #e6eefc;
        color: #064e9c;
      }
      .output {
        margin-top: 16px;
        padding: 12px;
        border-radius: 6px;
        background: #fbfdff;
        border: 1px solid #eef2ff;
        max-height: 320px;
        overflow: auto;
      }
      small.hint {
        color: #556;
        display: block;
        margin-bottom: 8px;
      }
      ul.address-list {
        padding-left: 18px;
        margin: 8px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Address Generator</h1>
      <p class="hint">
        Enter a beginning and ending number, an address line and a postcode.
        Click Generate to produce addresses for each number in the range.
      </p>

      <form id="genForm">
        <div class="row">
          <div class="col">
            <label for="start">Beginning number</label>
            <input
              id="start"
              name="start"
              type="number"
              placeholder="e.g. 1"
              required
            />
          </div>
          <div class="col">
            <label for="end">Ending number</label>
            <input
              id="end"
              name="end"
              type="number"
              placeholder="e.g. 10"
              required
            />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="address">Address</label>
            <input id="address" name="address" type="text" required />
          </div>
          <div class="col">
            <label for="postcode">Postcode</label>
            <input
              id="postcode"
              name="postcode"
              type="text"
              placeholder="e.g. NW1 6XE"
              required
            />
          </div>
        </div>

        <!-- Additional fields for export headers -->
        <div style="margin-top:12px; border-top:1px solid #eef2ff; padding-top:12px">
          <h3 style="margin:0 0 8px 0; font-size:15px">Parcel / Recipient Details</h3>
          <div class="row">
            <div class="col">
              <label for="recipientName">*Recipient Name</label>
              <input id="recipientName" name="recipientName" type="text" required placeholder="Recipient full name" />
            </div>
            <div class="col">
              <label for="recipientPhone">*Recipient Phone</label>
              <input id="recipientPhone" value="60127162252" name="recipientPhone" type="text" required placeholder="e.g. +60123456789" />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="parcelWeight">*Parcel Weight (KG)</label>
              <input id="parcelWeight" value="1" name="parcelWeight" type="number" step="0.01" min="0" required />
            </div>
            <div class="col">
              <label for="parcelLength">*Parcel Length (CM)</label>
              <input id="parcelLength" value="1" name="parcelLength" type="number" step="0.1" min="0" required />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="parcelWidth">*Parcel Width (CM)</label>
              <input id="parcelWidth" value="1" name="parcelWidth" type="number" step="0.1" min="0" required />
            </div>
            <div class="col">
              <label for="parcelHeight">*Parcel Height (CM)</label>
              <input id="parcelHeight" value="1" name="parcelHeight" type="number" step="0.1" min="0" required />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="itemName">*Item Name</label>
              <input id="itemName" name="itemName" type="text" required />
            </div>
            <div class="col">
              <label for="itemQuantity">Item Quantity</label>
              <input id="itemQuantity" name="itemQuantity" type="number" min="1" value="1" />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="customerRef">Customer Reference No.</label>
              <input id="customerRef" name="customerRef" type="text" />
            </div>
            <div class="col">
              <label for="paymentMethod">*Payment Method</label>
              <select id="paymentMethod" name="paymentMethod" required>
                <option value="Sender Pay">Sender Pay</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="deliveryInstruction">Delivery Instruction</label>
              <input id="deliveryInstruction" name="deliveryInstruction" type="text" />
            </div>
            <div class="col">
              <label for="parcelValue">*Parcel Value (Max 200 MYR)</label>
              <input id="parcelValue" value="200" name="parcelValue" type="number" step="0.01" min="0" max="200" required />
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit">Generate</button>
          <button type="button" id="clearBtn" class="secondary">Clear</button>
          <button type="button" id="downloadBtn" class="secondary" disabled>
            Download Excel
          </button>
          <span style="margin-left: auto; color: #666; font-size: 13px"
            >Max 500 addresses</span
          >
        </div>
      </form>

      <div id="output" class="output" aria-live="polite"></div>
    </div>

    <!-- SheetJS (xlsx) for client-side .xlsx generation. If offline, the code will fall back to CSV download. -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script>
      (function () {
        let generatedAddresses = [];
        const form = document.getElementById("genForm");
        const startEl = document.getElementById("start");
        const endEl = document.getElementById("end");
        const addressEl = document.getElementById("address");
        const postcodeEl = document.getElementById("postcode");
        // New fields
        const recipientNameEl = document.getElementById("recipientName");
        const recipientPhoneEl = document.getElementById("recipientPhone");
        const parcelWeightEl = document.getElementById("parcelWeight");
        const parcelLengthEl = document.getElementById("parcelLength");
        const parcelWidthEl = document.getElementById("parcelWidth");
        const parcelHeightEl = document.getElementById("parcelHeight");
        const itemNameEl = document.getElementById("itemName");
        const itemQuantityEl = document.getElementById("itemQuantity");
        const customerRefEl = document.getElementById("customerRef");
        const paymentMethodEl = document.getElementById("paymentMethod");
        const deliveryInstructionEl = document.getElementById("deliveryInstruction");
        const parcelValueEl = document.getElementById("parcelValue");
        const output = document.getElementById("output");
        const clearBtn = document.getElementById("clearBtn");
        const downloadBtn = document.getElementById("downloadBtn");

        function showError(msg) {
          output.innerHTML = '<div style="color:#9b1c1c">' + msg + "</div>";
        }

        form.addEventListener("submit", function (e) {
          e.preventDefault();
          const start = parseInt(startEl.value, 10);
          const end = parseInt(endEl.value, 10);
          const addr = addressEl.value.trim();
          const pc = postcodeEl.value.trim();

          if (Number.isNaN(start) || Number.isNaN(end)) {
            showError(
              "Please enter valid numeric beginning and ending numbers."
            );
            return;
          }
          if (start > end) {
            showError(
              "Beginning number must be less than or equal to ending number."
            );
            return;
          }
          if (!addr) {
            showError("Please enter an address (street).");
            return;
          }
          if (!pc) {
            showError("Please enter a postcode.");
            return;
          }

          // Validate required new fields
          if (!recipientNameEl.value.trim()) { showError('Please enter Recipient Name.'); return; }
          if (!recipientPhoneEl.value.trim()) { showError('Please enter Recipient Phone.'); return; }
          if (!parcelWeightEl.value || Number(parcelWeightEl.value) < 0) { showError('Please enter a valid Parcel Weight.'); return; }
          if (!parcelLengthEl.value || Number(parcelLengthEl.value) < 0) { showError('Please enter a valid Parcel Length.'); return; }
          if (!parcelWidthEl.value || Number(parcelWidthEl.value) < 0) { showError('Please enter a valid Parcel Width.'); return; }
          if (!parcelHeightEl.value || Number(parcelHeightEl.value) < 0) { showError('Please enter a valid Parcel Height.'); return; }
          if (!itemNameEl.value.trim()) { showError('Please enter Item Name.'); return; }
          if (!paymentMethodEl.value) { showError('Please choose a Payment Method.'); return; }
          if (!parcelValueEl.value || Number(parcelValueEl.value) < 0) { showError('Please enter Parcel Value.'); return; }
          if (Number(parcelValueEl.value) > 200) { showError('Parcel Value must be 200 MYR or less.'); return; }

          // Count how many numbers will be generated when stepping by 2
          const count = Math.floor((end - start) / 2) + 1;
          if (count > 500) {
            showError(
              "Range is too large. Please limit to 500 addresses or fewer."
            );
            return;
          }

          const list = document.createElement("ul");
          list.className = "address-list";
          generatedAddresses = [];
          // Build exported rows (array of arrays) and also render a readable list
          const exportedRows = [];
          for (let i = start; i <= end; i += 2) {
            const detailAddress = `${i} ${addr}, ${pc}`;
            const li = document.createElement("li");
            li.textContent = detailAddress;
            list.appendChild(li);

            // Row order matches requested header
            const row = [
              recipientNameEl.value.trim(),
              recipientPhoneEl.value.trim(),
              detailAddress,
              pc,
              parcelWeightEl.value,
              parcelLengthEl.value,
              parcelWidthEl.value,
              parcelHeightEl.value,
              itemNameEl.value.trim(),
              itemQuantityEl.value || '1',
              customerRefEl.value.trim(),
              paymentMethodEl.value,
              deliveryInstructionEl.value.trim(),
              parcelValueEl.value
            ];
            exportedRows.push(row);
            generatedAddresses.push(detailAddress);
          }

          output.innerHTML = "";
          output.appendChild(list);
          // store exported rows and enable download
          window.__exportedRows = exportedRows;
          downloadBtn.disabled = exportedRows.length === 0;
        });

        clearBtn.addEventListener("click", function () {
          startEl.value = "";
          endEl.value = "";
          addressEl.value = "";
          postcodeEl.value = "";
          output.innerHTML = "";
          generatedAddresses = [];
          downloadBtn.disabled = true;
        });

        // Helper to download CSV fallback
        function downloadCSV(filename, rows) {
          const csv = rows
            .map((r) => '"' + r.replace(/"/g, '""') + '"')
            .join("\r\n");
          const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }

        // Download as .xlsx (single column, no header). Falls back to CSV if SheetJS isn't available.
        downloadBtn.addEventListener("click", function () {
          // exported rows were stored when generating
          const rows = window.__exportedRows || [];
          if (!rows || rows.length === 0) return;
          const ts = Date.now();
          const filename = `${ts}.xlsx`;
          // Header with asterisks for required fields as requested
          const header = [
            '*Recipient Name',
            '*Recipient Phone',
            '*Detail Address',
            '*Postal Code',
            '*Parcel Weight (KG)',
            '*Parcel Length (CM)',
            '*Parcel Width (CM)',
            '*Parcel Height (CM)',
            '*Item Name',
            'Item Quantity',
            'Customer Reference No.',
            '*Payment Method',
            'Delivery Instruction',
            '*Parcel Value (Max 200 MYR)'
          ];

          if (window.XLSX && typeof window.XLSX.utils !== "undefined") {
            const aoa = [header].concat(rows);
            const ws = XLSX.utils.aoa_to_sheet(aoa);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, filename);
          } else {
            // Fallback to CSV with header
            const csvRows = [header].concat(rows).map(r => r.map(c => String(c || '')));
            // flatten to CSV lines
            const csvLines = csvRows.map(cols => cols.map(c => '"' + c.replace(/"/g,'""') + '"').join(','));
            const blob = new Blob([csvLines.join('\r\n')], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${ts}.csv`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          }
        });
      })();
    </script>
  </body>
</html>
